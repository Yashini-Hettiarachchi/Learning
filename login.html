<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Login - Magic Mind</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  </head>
  <body>
    <main class="container">
      <h1>Login</h1>
      <form id="login-form">
        <div>
          <label for="email">Email</label>
          <input id="email" type="email" required />
        </div>
        <div>
          <label for="password">Password</label>
          <input id="password" type="password" required />
        </div>
        <button type="submit">Login</button>
      </form>
      <p>New here? <a href="signup.html">Create an account</a></p>

      <div id="message" role="status" aria-live="polite"></div>
    </main>

    <script>
      // TODO: Replace with your Firebase project config (from Firebase Console -> Project settings -> Your apps)
      const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_AUTH_DOMAIN",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_STORAGE_BUCKET",
        messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
        appId: "YOUR_APP_ID"
      };

      function isConfigValid(cfg) {
        if (!cfg) return false;
        const bad = (v) => !v || typeof v !== 'string' || v.trim() === '' || v.includes('YOUR_');
        if (bad(cfg.apiKey) || bad(cfg.authDomain) || bad(cfg.projectId)) return false;
        return true;
      }

      const message = document.getElementById('message');
      const loginForm = document.getElementById('login-form');

      if (!isConfigValid(firebaseConfig)) {
        const instruction = `
          <strong>Firebase configuration missing or invalid.</strong>
          <p>To enable authentication: 1) Create a Firebase project at <a href="https://console.firebase.google.com/" target="_blank">console.firebase.google.com</a>;
          2) Register a Web app (</>), copy the config object and paste it into the <code>firebaseConfig</code> object in this file;
          3) In Firebase Console → Authentication → Sign-in method enable <em>Email/Password</em>;
          4) Serve the page over HTTP(S) (do not open via <code>file://</code>).</p>
        `;
        if (message) message.innerHTML = instruction;
        // disable form controls to avoid confusing API errors
        loginForm.querySelectorAll('input, button').forEach(el => el.disabled = true);
        console.warn('Firebase config looks invalid or uses placeholder values. Please add your project config to login.html.');
      } else {
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        loginForm.addEventListener('submit', (e) => {
          e.preventDefault();
          const email = document.getElementById('email').value.trim();
          const password = document.getElementById('password').value;
          message.textContent = 'Signing in...';

          auth.signInWithEmailAndPassword(email, password)
            .then((userCredential) => {
              message.textContent = 'Login successful. Redirecting...';
              loginForm.reset();
              setTimeout(() => {
                window.location.href = 'index.html';
              }, 800);
            })
            .catch((error) => {
              message.textContent = error.message;
            });
        });
      }
    </script>
  </body>
</html>
